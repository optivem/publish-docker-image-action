name: ci

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Validate action.yml
      run: |
        # Check if action.yml is valid YAML
        python -c "import yaml; yaml.safe_load(open('action.yml'))"
        echo "✅ action.yml is valid YAML"
        
    - name: Test action inputs
      run: |
        # Validate that all required inputs are defined
        grep -q "image-name:" action.yml
        grep -q "registry-password:" action.yml
        echo "✅ All required inputs are defined"
        
    - name: Check branding
      run: |
        # Validate branding section exists
        grep -q "branding:" action.yml
        grep -q "icon:" action.yml
        grep -q "color:" action.yml
        echo "✅ Branding section is properly configured"

  integration-test:
    runs-on: ubuntu-latest
    if: github.event_name == 'pull_request'
    
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      
    - name: Create test Dockerfile
      run: |
        cat > Dockerfile << 'EOF'
        FROM alpine:latest
        RUN echo "Test image" > /test.txt
        CMD ["cat", "/test.txt"]
        EOF
        
    - name: Test the action
      uses: ./
      with:
        image-name: test-image
        registry-password: ${{ secrets.GITHUB_TOKEN }}